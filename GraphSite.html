<!DOCTYPE html>
<html>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

    <body>
        <div id="returnOnInvestments" style="width:99%;"></div>
        <div id="Buy Order" style="max-height:500px; overflow-y:auto"></div>
        <script>
            //Define Layout
            var layout = {
                title: "Return on investement for buildings and upgrades over time.",
                height: 1000,
            };

            window.addEventListener('message', function(event) {
                if(event.srcElement.location.href == window.location.href) {
                    // Display using Plotly
                    Plotly.newPlot("returnOnInvestments", event.data[0], layout);
                    document.getElementById("Buy Order").innerHTML = DataConverter(event.data[1]);
                }
            });

            function DataConverter(data) {
                var output = "<ol>";
                var compressedData = []
                for(var item in data) {
                    item = data[item];
                    if(compressedData[compressedData.length - 1] && compressedData[compressedData.length - 1]["item"] == item["item"]) compressedData[compressedData.length - 1]["amount"]++;
                    else compressedData.push({item: item["item"], amount: 1, time: item["time"]})
                }
                for(var items in compressedData) {
                    items = compressedData[items];
                    output += "<li>" + items["amount"] + "x " + items["item"] + " at " + items["time"] + "</li>";
                }
                output += "</ol>";
                return output
            }
        </script>

    </body>
</html>

